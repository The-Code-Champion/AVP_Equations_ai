<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVP Equations Calculator</title>
    <!-- Load KaTeX CSS for equation rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" xintegrity="sha384-GvrF9Q88p0+dK4xOaW5h+6bQkL13U0N3x+0Q2+5bQ2+1w==" crossorigin="anonymous">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .container {
            width: 100%;
            max-width: 32rem;
            background-color: #161b22;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #374151;
        }
        @media (min-width: 768px) {
            .container {
                padding: 2.5rem;
            }
        }
        .input-field {
            /* Input fields are still w-full within their small container for a neat look */
            width: 100%;
            padding: 0.75rem;
            background-color: #3d444d;
            color: white;
            border: 1px solid #444c56;
            border-radius: 0.5rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        /* UPDATED: Changed color to cyan for better definition and added shadow-lg */
        .calc-button {
            width: 100%;
            background-color: #4595b0;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s;
        }
        .calc-button:hover {
            background-color: #367a8f;
        }
        .back-button {
            /* Transparent back button: no solid background */
            background-color: transparent;
            color: #4595b0;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, color 0.15s;
            box-shadow: none;
        }
        .back-button:hover {
            background-color: rgba(54,122,143,0.08);
            color: #367a8f;
        }
        /* (Home link moved into menu view) */
        .menu-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            margin-bottom: 1rem;
        }

        .menu-button {
            background-color: #4595b0;
            color: white;
            font-weight: 600;
            padding: 0.5rem 0.75rem;
            margin: 0.25rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            box-shadow: 0 6px 10px -3px rgba(0, 0, 0, 0.3);
            transition: background-color 0.15s, transform 0.06s;
            width: auto;
            min-width: 8.5rem;
        }
        .menu-button:hover {
            background-color: #367a8f;
            transform: translateY(-1px);
        }
        /* New style for centering form content */
        .centered-form-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .storage-display {
            background-color: #1f2937;
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            width: 100%;
        }
        .storage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #374151;
        }
        .storage-item:last-child {
            border-bottom: none;
        }
        .storage-label {
            font-weight: 500;
            color: #4595b0;
        }
        .storage-value {
            font-family: monospace;
            color: #22c55e;
            font-weight: 600;
        }
        .storage-button {
            background-color: #6b7280;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background-color 0.2s;
        }
        .storage-button:hover {
            background-color: #4b5563;
        }
        .save-result-button {
            background-color: #8b5cf6;
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .save-result-button:hover {
            background-color: #7c3aed;
        }
        /* Input row: label, input, button inline and wrapping */
        .input-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }
        .input-row label {
            min-width: 9rem;
            margin: 0;
        }
        .input-row .input-field {
            flex: 1 1 10rem;
            margin: 0;
        }
        .use-stored-button {
            background-color: #10b981;
            color: white;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.15s, transform 0.08s;
            font-size: 0.75rem;
            width: auto;
            margin: 0;
            white-space: nowrap;
        }
        .use-stored-button:active { transform: translateY(1px); }
        .use-stored-button:hover { background-color: #059669; }
    </style>
</head>
<body>

    <div class="container">
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 1rem;">
            <h1 id="main-title" class="text-3xl font-bold text-center" style="color: #4595b0; margin: 0;">AVP Equations</h1>
        </div>
        <p class="text-center text-gray-400 mb-8">Engineering Calculation Tools</p>

        <!-- Stored Values Display -->
        <div id="storage-section" class="storage-display hidden">
            <p class="text-sm font-semibold text-gray-300 mb-2">Stored Values:</p>
            <div id="storage-list"></div>
        </div>

        <!-- Main Menu View -->
        <div id="menu-view" class="view">
            <h2 class="text-xl font-semibold mb-6 text-center">Choose Calculation Category</h2>
            <div class="menu-row">
                <button onclick="showView('aero-menu')" class="menu-button">Aerodynamic</button>
                <button onclick="showView('atmos-menu')" class="menu-button">Atmosphere</button>
                <button onclick="showView('prop-menu')" class="menu-button">Propeller</button>
                <button onclick="showView('jet-menu')" class="menu-button">Jet Engine</button>
                <button onclick="showView('rocket-menu')" class="menu-button">Rocket Engine</button>
            </div>
            <div style="display:flex; justify-content:center; margin-top:1rem;">
                <a href="index.html" class="back-button" style="width:auto;">← Back to Home</a>
            </div>
        </div>

        <!-- ===== AERODYNAMIC SUB-MENU ===== -->
        <div id="aero-menu" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold mb-6 text-center">Aerodynamic Calculations</h2>
            <div class="menu-row">
                <button onclick="showView('CD_calc')" class="menu-button">Calculate \(C_D\)</button>
                <button onclick="showView('K_calc')" class="menu-button">Calculate \(K\)</button>
                <button onclick="showView('AR_calc')" class="menu-button">Calculate \(AR\)</button>
                <button onclick="showView('CL_calc')" class="menu-button">Calculate \(C_L\)</button>
                <button onclick="showView('V_calc')" class="menu-button">Velocity \(V\)</button>
                <button onclick="showView('L_calc')" class="menu-button">Lift (L)</button>
                <button onclick="showView('q_calc')" class="menu-button">Dynamic Pressure (q)</button>
                <button onclick="showView('D_calc')" class="menu-button">Drag (D)</button>
            </div>
            <button onclick="showView('menu-view')" class="back-button" style="width:auto; margin-top:1rem;">← Back to Main Menu</button>
        </div>

        <!-- ===== ATMOSPHERE SUB-MENU ===== -->
        <div id="atmos-menu" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold mb-6 text-center">Atmospheric Calculations</h2>
            <div class="menu-row">
                <button onclick="showView('Tropo_calc')" class="menu-button">Troposphere</button>
                <button onclick="showView('Strato_calc')" class="menu-button">Stratosphere</button>
                <button onclick="showView('P_calc')" class="menu-button">Pressure (P)</button>
                <button onclick="showView('a_calc')" class="menu-button">Speed of Sound (a)</button>
                <button onclick="showView('M_calc')" class="menu-button">Mach (M)</button>
            </div>
            <button onclick="showView('menu-view')" class="back-button" style="width:auto; margin-top:1rem;">← Back to Main Menu</button>
        </div>

        <!-- ===== PROPELLER SUB-MENU ===== -->
        <div id="prop-menu" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold mb-6 text-center">Propeller Engine Calculations</h2>
            <div class="menu-row">
                <button onclick="showView('eta_p_calc')" class="menu-button">Prop Efficiency (\(\eta_p\))</button>
                <button onclick="showView('P_prop_calc')" class="menu-button">Prop Power (P)</button>
                   <button onclick="showView('T_prop_calc')" class="menu-button">Prop Thrust (T)</button>
            </div>
            <button onclick="showView('menu-view')" class="back-button" style="width:auto; margin-top:1rem;">← Back to Main Menu</button>
        </div>

        <!-- ===== JET SUB-MENU ===== -->
        <div id="jet-menu" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold mb-6 text-center">Jet Engine Calculations</h2>
            <div class="menu-row">
                <button onclick="showView('T_jet_calc')" class="menu-button">Jet Thrust (T)</button>
                <button onclick="showView('T_jet_alt_calc')" class="menu-button">Jet Thrust Alt (T)</button>
            </div>
            <button onclick="showView('menu-view')" class="back-button" style="width:auto; margin-top:1rem;">← Back to Main Menu</button>
        </div>

        <!-- ===== ROCKET SUB-MENU ===== -->
        <div id="rocket-menu" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold mb-6 text-center">Rocket Engine Calculations</h2>
            <div class="menu-row">
                <button onclick="showView('T_rocket_calc')" class="menu-button">Rocket Thrust (T)</button>
                <button onclick="showView('T_rocket_chamber_calc')" class="menu-button">Rocket Chamber (T)</button>
                <button onclick="showView('CF_calc')" class="menu-button">Discharge Coeff (\(C_F\))</button>
            </div>
            <button onclick="showView('menu-view')" class="back-button" style="width:auto; margin-top:1rem;">← Back to Main Menu</button>
        </div>

        <!-- CD Calculator View (CD = CDo + K * CL^2) -->
        <div id="CD_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Calculate \(C_D\)</h2>
            <p class="text-center text-gray-400">
                $$C_D = C_{D_0} + K \cdot C_L^2$$
            </p>
            <!-- Form is constrained to max-w-sm to allow centering effect to be visible -->
            <form id="CD_form" onsubmit="event.preventDefault(); calculateCD()" class="w-full max-w-xs space-y-4">
                <!-- Input Group: Parasitic Drag Coefficient -->
                <div class="w-full"><label for="cdo-cd" class="block text-sm font-medium mb-1">\(C_{D_0}\) (Parasitic Drag)</label><input type="number" id="cdo-cd" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cdo-cd', 'C_D0')">Use Stored</button></div>
                <!-- Input Group: Induced Drag Factor -->
                <div class="w-full"><label for="k-cd" class="block text-sm font-medium mb-1">\(K\) (Induced Drag Factor)</label><input type="number" id="k-cd" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('k-cd', 'K')">Use Stored</button></div>
                <!-- Input Group: Coefficient of Lift -->
                <div class="w-full"><label for="cl-cd" class="block text-sm font-medium mb-1">\(C_L\) (Coefficient of Lift)</label><input type="number" id="cl-cd" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cl-cd', 'C_L')">Use Stored</button></div>
                <!-- Calculation Button -->
                <button type="submit" class="calc-button">Calculate \(C_D\)</button>
            </form>
            <div id="CD_result" class="result-box w-full max-w-xs"></div>
            <!-- Navigation Button -->
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- K Calculator View (K = 1 / (π * e * AR)) -->
        <div id="K_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Calculate \(K\)</h2>
            <p class="text-center text-gray-400">
                $$K = \frac{1}{\pi \cdot e \cdot AR}$$
            </p>
            <form id="K_form" onsubmit="event.preventDefault(); calculateK()" class="w-full max-w-xs space-y-4">
                <!-- Input Group: Oswald Efficiency Factor -->
                <div class="w-full"><label for="e-k" class="block text-sm font-medium mb-1">\(e\) (Oswald Efficiency Factor)</label><input type="number" id="e-k" step="any" required class="input-field" placeholder="e.g., 0.9"><button type="button" class="use-stored-button" onclick="useStoredValue('e-k', 'e')">Use Stored</button></div>
                <!-- Input Group: Aspect Ratio -->
                <div class="w-full"><label for="ar-k" class="block text-sm font-medium mb-1">\(AR\) (Aspect Ratio)</label><input type="number" id="ar-k" step="any" required class="input-field" placeholder="e.g., 8.5"><button type="button" class="use-stored-button" onclick="useStoredValue('ar-k', 'AR')">Use Stored</button></div>
                <!-- Calculation Button -->
                <button type="submit" class="calc-button">Calculate \(K\)</button>
            </form>
            <div id="K_result" class="result-box w-full max-w-xs"></div>
            <!-- Navigation Button -->
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- AR Calculator View (AR = b^2 / S) -->
        <div id="AR_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Calculate \(AR\)</h2>
            <p class="text-center text-gray-400">
                $$AR = \frac{b^2}{S}$$
            </p>
            <form id="AR_form" onsubmit="event.preventDefault(); calculateAR()" class="w-full max-w-xs space-y-4">
                <!-- Input Group: Wingspan -->
                <div class="w-full"><label for="b-ar" class="block text-sm font-medium mb-1">\(b\) (Wingspan)</label><input type="number" id="b-ar" step="any" required class="input-field" placeholder="m or ft"><button type="button" class="use-stored-button" onclick="useStoredValue('b-ar', 'b')">Use Stored</button></div>
                <!-- Input Group: Reference Area -->
                <div class="w-full"><label for="s-ar" class="block text-sm font-medium mb-1">\(S\) (Reference Area)</label><input type="number" id="s-ar" step="any" required class="input-field" placeholder="m² or ft²"><button type="button" class="use-stored-button" onclick="useStoredValue('s-ar', 'S')">Use Stored</button></div>
                <!-- Calculation Button -->
                <button type="submit" class="calc-button">Calculate \(AR\)</button>
            </form>
            <div id="AR_result" class="result-box w-full max-w-xs"></div>
            <!-- Navigation Button -->
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- CL Calculator View (CL = sqrt((CD - CDo) / K)) -->
        <div id="CL_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Calculate \(C_L\)</h2>
            <p class="text-center text-gray-400">
                $$C_L = \sqrt{\frac{C_D - C_{D_0}}{K}}$$
            </p>
            <form id="CL_form" onsubmit="event.preventDefault(); calculateCL()" class="w-full max-w-xs space-y-4">
                <!-- Input Group: Coefficient of Drag -->
                <div class="w-full"><label for="cd-cl" class="block text-sm font-medium mb-1">\(C_D\)</label><input type="number" id="cd-cl" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cd-cl', 'C_D')">Use Stored</button></div>
                <!-- Input Group: Parasitic Drag Coefficient -->
                <div class="w-full"><label for="cdo-cl" class="block text-sm font-medium mb-1">\(C_{D_0}\)</label><input type="number" id="cdo-cl" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cdo-cl', 'C_D0')">Use Stored</button></div>
                <!-- Input Group: Induced Drag Factor -->
                <div class="w-full"><label for="k-cl" class="block text-sm font-medium mb-1">\(K\)</label><input type="number" id="k-cl" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('k-cl', 'K')">Use Stored</button></div>
                <!-- Calculation Button -->
                <button type="submit" class="calc-button">Calculate \(C_L\)</button>
            </form>
            <div id="CL_result" class="result-box w-full max-w-xs"></div>
            <!-- Navigation Button -->
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- Velocity Calculator View (V = sqrt( (2*W) / (rho * S * CL) )) -->
        <div id="V_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Calculate Velocity (\(V\))</h2>
            <p class="text-center text-gray-400">
                $$V = \sqrt{\frac{2 \cdot W}{\rho \cdot S \cdot C_L}}$$
            </p>
            <form id="V_form" onsubmit="event.preventDefault(); calculateV()" class="w-full max-w-xs space-y-4">
                <!-- Input Group: Weight/Lift Force -->
                <div class="w-full"><label for="W-v" class="block text-sm font-medium mb-1">\(W\) (Weight/Lift Force)</label><input type="number" id="W-v" step="any" required class="input-field" placeholder="Newtons or lbs"><button type="button" class="use-stored-button" onclick="useStoredValue('W-v', 'W')">Use Stored</button></div>
                <!-- Input Group: Air Density -->
                <div class="w-full"><label for="rho-v" class="block text-sm font-medium mb-1">\(\rho\) (Air Density)</label><input type="number" id="rho-v" step="any" required class="input-field" placeholder="e.g., 1.225 kg/m^3"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-v', 'rho')">Use Stored</button></div>
                <!-- Input Group: Reference Area -->
                <div class="w-full"><label for="S-v" class="block text-sm font-medium mb-1">\(S\) (Reference Area)</label><input type="number" id="S-v" step="any" required class="input-field" placeholder="m^2 or ft^2"><button type="button" class="use-stored-button" onclick="useStoredValue('S-v', 'S')">Use Stored</button></div>
                <!-- Input Group: Coefficient of Lift -->
                <div class="w-full"><label for="cl-v" class="block text-sm font-medium mb-1">\(C_L\) (Coefficient of Lift)</label><input type="number" id="cl-v" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cl-v', 'C_L')">Use Stored</button></div>
                <!-- Calculation Button -->
                <button type="submit" class="calc-button">Calculate \(V\)</button>
            </form>
            <div id="V_result" class="result-box w-full max-w-xs"></div>
            <!-- Navigation Button -->
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- Troposphere Calculator View -->
        <div id="Tropo_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Troposphere ISA</h2>
            <p class="text-center text-gray-400">T_ISA = T_o - L · h<br>P / P_o = (T_ISA / T_o)^5.256</p>
            <form id="Tropo_form" onsubmit="event.preventDefault(); calculateTropo()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="T0-t">\(T_o\) (Reference Temp)</label><input type="number" id="T0-t" step="any" required class="input-field" placeholder="e.g., 288.15"><button type="button" class="use-stored-button" onclick="useStoredValue('T0-t','T_o')">Use Stored</button></div>
                <div class="w-full input-row"><label for="L-t">\(L\) (Lapse Rate)</label><input type="number" id="L-t" step="any" required class="input-field" placeholder="e.g., 0.0065"><button type="button" class="use-stored-button" onclick="useStoredValue('L-t','L')">Use Stored</button></div>
                <div class="w-full input-row"><label for="h-t">\(h\) (Altitude)</label><input type="number" id="h-t" step="any" required class="input-field" placeholder="meters"><button type="button" class="use-stored-button" onclick="useStoredValue('h-t','h')">Use Stored</button></div>
                <div class="w-full input-row"><label for="P0-t">\(P_o\) (Reference Pressure, optional)</label><input type="number" id="P0-t" step="any" class="input-field" placeholder="e.g., 101325"><button type="button" class="use-stored-button" onclick="useStoredValue('P0-t','P_o')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Troposphere</button>
            </form>
            <div id="Tropo_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('atmos-menu')" class="back-button">← Back to Atmosphere</button>
        </div>

        <!-- Stratosphere Calculator View -->
        <div id="Strato_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Stratosphere ISA</h2>
            <p class="text-center text-gray-400">T_ISA = -56<br>P / P_o = 0.2234 · exp((11000 - h)/6342)</p>
            <form id="Strato_form" onsubmit="event.preventDefault(); calculateStrato()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="h-s">\(h\) (Altitude)</label><input type="number" id="h-s" step="any" required class="input-field" placeholder="meters"><button type="button" class="use-stored-button" onclick="useStoredValue('h-s','h')">Use Stored</button></div>
                <div class="w-full input-row"><label for="P0-s">\(P_o\) (Reference Pressure, optional)</label><input type="number" id="P0-s" step="any" class="input-field" placeholder="e.g., 101325"><button type="button" class="use-stored-button" onclick="useStoredValue('P0-s','P_o')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Stratosphere</button>
            </form>
            <div id="Strato_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('atmos-menu')" class="back-button">← Back to Atmosphere</button>
        </div>

        <!-- Pressure Calculator View (P = rho * R * T) -->
        <div id="P_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Pressure (Ideal Gas)</h2>
            <p class="text-center text-gray-400">$$P = \rho R T$$</p>
            <form id="P_form" onsubmit="event.preventDefault(); calculatePressure()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="rho-p">\(\rho\) (Density)</label><input type="number" id="rho-p" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-p','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="R-p">\(R\) (Specific Gas Constant)</label><input type="number" id="R-p" step="any" class="input-field" placeholder="default 287.058"><button type="button" class="use-stored-button" onclick="useStoredValue('R-p','R')">Use Stored</button></div>
                <div class="w-full input-row"><label for="T-p">\(T\) (Temperature)</label><input type="number" id="T-p" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('T-p','T')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Pressure</button>
            </form>
            <div id="P_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('atmos-menu')" class="back-button">← Back to Atmosphere</button>
        </div>

        <!-- Speed of sound Calculator View (a = sqrt(gamma * R * T)) -->
        <div id="a_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Speed of Sound (a)</h2>
            <p class="text-center text-gray-400">$$a = \sqrt{\gamma R T}$$</p>
            <form id="a_form" onsubmit="event.preventDefault(); calculateSpeedOfSound()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="gamma-a">\(\gamma\) (Ratio of specific heats)</label><input type="number" id="gamma-a" step="any" class="input-field" placeholder="default 1.4"><button type="button" class="use-stored-button" onclick="useStoredValue('gamma-a','gamma')">Use Stored</button></div>
                <div class="w-full input-row"><label for="R-a">\(R\) (Specific Gas Constant)</label><input type="number" id="R-a" step="any" class="input-field" placeholder="default 287.058"><button type="button" class="use-stored-button" onclick="useStoredValue('R-a','R')">Use Stored</button></div>
                <div class="w-full input-row"><label for="T-a">\(T\) (Temperature)</label><input type="number" id="T-a" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('T-a','T')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate a</button>
            </form>
            <div id="a_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('atmos-menu')" class="back-button">← Back to Atmosphere</button>
        </div>

        <!-- Mach Calculator View (M = V / a) -->
        <div id="M_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Mach Number (M)</h2>
            <p class="text-center text-gray-400">$$M = \frac{V}{a}$$</p>
            <form id="M_form" onsubmit="event.preventDefault(); calculateMach()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="V-m">\(V\) (Velocity)</label><input type="number" id="V-m" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-m','V')">Use Stored</button></div>
                <div class="w-full input-row"><label for="a-m">\(a\) (Speed of Sound)</label><input type="number" id="a-m" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('a-m','a')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Mach</button>
            </form>
            <div id="M_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('atmos-menu')" class="back-button">← Back to Atmosphere</button>
        </div>

        <!-- Lift Calculator View (L = 1/2 rho V^2 S C_L) -->
        <div id="L_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Lift (L)</h2>
            <p class="text-center text-gray-400">$$L = \tfrac{1}{2} \rho V^2 S C_L$$</p>
            <form id="L_form" onsubmit="event.preventDefault(); calculateLift()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="rho-l">\(\rho\) (Density)</label><input type="number" id="rho-l" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-l','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="V-l">\(V\) (Velocity)</label><input type="number" id="V-l" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-l','V')">Use Stored</button></div>
                <div class="w-full input-row"><label for="S-l">\(S\) (Reference Area)</label><input type="number" id="S-l" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('S-l','S')">Use Stored</button></div>
                <div class="w-full input-row"><label for="cl-l">\(C_L\) (Coefficient of Lift)</label><input type="number" id="cl-l" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('cl-l','C_L')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Lift</button>
            </form>
            <div id="L_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- Dynamic Pressure Calculator View (q = 1/2 * rho * V^2) -->
        <div id="q_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Dynamic Pressure (q)</h2>
            <p class="text-center text-gray-400">$$q = \tfrac{1}{2} \rho V^2$$</p>
            <form id="q_form" onsubmit="event.preventDefault(); calculateDynamicPressure()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="rho-q">\(\rho\) (Density)</label><input type="number" id="rho-q" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-q','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="V-q">\(V\) (Velocity)</label><input type="number" id="V-q" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-q','V')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate q</button>
            </form>
            <div id="q_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- Drag Calculator View (D = 1/2 * rho * V^2 * S * C_D) -->
        <div id="D_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Drag (D)</h2>
            <p class="text-center text-gray-400">$$D = \tfrac{1}{2} \rho V^2 S C_D$$</p>
            <form id="D_form" onsubmit="event.preventDefault(); calculateDrag()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="rho-d">\(\rho\) (Density)</label><input type="number" id="rho-d" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-d','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="V-d">\(V\) (Velocity)</label><input type="number" id="V-d" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-d','V')">Use Stored</button></div>
                <div class="w-full input-row"><label for="S-d">\(S\) (Reference Area)</label><input type="number" id="S-d" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('S-d','S')">Use Stored</button></div>
                <div class="w-full input-row"><label for="CD-d">\(C_D\) (Drag Coefficient)</label><input type="number" id="CD-d" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('CD-d','C_D')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate D</button>
            </form>
            <div id="D_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('aero-menu')" class="back-button">← Back to Aerodynamic</button>
        </div>

        <!-- Propeller Efficiency Calculator View (eta_p = T*V / P_shaft) -->
        <div id="eta_p_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Propeller Efficiency (\(\eta_p\))</h2>
            <p class="text-center text-gray-400">$$\eta_p = \frac{T \cdot V}{P_{shaft}}$$</p>
            <form id="eta_p_form" onsubmit="event.preventDefault(); calculatePropEfficiency()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="T-eta">\(T\) (Thrust)</label><input type="number" id="T-eta" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('T-eta','T')">Use Stored</button></div>
                <div class="w-full input-row"><label for="V-eta">\(V\) (Velocity)</label><input type="number" id="V-eta" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-eta','V')">Use Stored</button></div>
                <div class="w-full input-row"><label for="P-eta">\(P_{shaft}\) (Shaft Power)</label><input type="number" id="P-eta" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('P-eta','P_shaft')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate \(\eta_p\)</button>
            </form>
            <div id="eta_p_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('prop-menu')" class="back-button">← Back to Propeller</button>
        </div>

           <!-- Propeller Thrust Calculator View (T = eta_p * P_shaft / V) -->
           <div id="T_prop_calc" class="view hidden space-y-6 centered-form-content">
               <h2 class="text-xl font-semibold text-center text-green-400">Propeller Thrust (T)</h2>
               <p class="text-center text-gray-400">Derived from $$\eta_p = \frac{T \cdot V}{P_{shaft}}$$ solving for T: $$T = \frac{\eta_p \cdot P_{shaft}}{V}$$</p>
               <form id="T_prop_form" onsubmit="event.preventDefault(); calculatePropThrust()" class="w-full max-w-xs space-y-4">
                   <div class="w-full input-row"><label for="eta-prop">\(\eta_p\) (Propeller Efficiency)</label><input type="number" id="eta-prop" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('eta-prop','eta_p')">Use Stored</button></div>
                   <div class="w-full input-row"><label for="Pshaft-prop">\(P_{shaft}\) (Shaft Power)</label><input type="number" id="Pshaft-prop" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('Pshaft-prop','P_shaft')">Use Stored</button></div>
                   <div class="w-full input-row"><label for="V-prop">\(V\) (Velocity)</label><input type="number" id="V-prop" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('V-prop','V')">Use Stored</button></div>
                   <button type="submit" class="calc-button">Calculate T</button>
               </form>
               <div id="T_prop_result" class="result-box w-full max-w-xs"></div>
               <button onclick="showView('prop-menu')" class="back-button">← Back to Propeller</button>
           </div>

        <!-- Jet Thrust Calculator View (T = Mdot*(V_exit - V_inlet) + A_exit(P_exit - P_ambient)) -->
        <div id="T_jet_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Jet Thrust (T)</h2>
            <p class="text-center text-gray-400">$$T = \dot{m}(V_{exit} - V_{inlet}) + A_{exit}(P_{exit} - P_{ambient})$$</p>
            <form id="T_jet_form" onsubmit="event.preventDefault(); calculateJetThrust()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="mdot-jet">\(\dot{m}\) (Mass Flow Rate)</label><input type="number" id="mdot-jet" step="any" required class="input-field" placeholder="kg/s"><button type="button" class="use-stored-button" onclick="useStoredValue('mdot-jet','mdot')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Vexit-jet">\(V_{exit}\) (Exit Velocity)</label><input type="number" id="Vexit-jet" step="any" required class="input-field" placeholder="m/s"><button type="button" class="use-stored-button" onclick="useStoredValue('Vexit-jet','V_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Vinlet-jet">\(V_{inlet}\) (Inlet Velocity)</label><input type="number" id="Vinlet-jet" step="any" required class="input-field" placeholder="m/s"><button type="button" class="use-stored-button" onclick="useStoredValue('Vinlet-jet','V_inlet')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Aexit-jet">\(A_{exit}\) (Exit Area)</label><input type="number" id="Aexit-jet" step="any" class="input-field" placeholder="m² (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Aexit-jet','A_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pexit-jet">\(P_{exit}\) (Exit Pressure)</label><input type="number" id="Pexit-jet" step="any" class="input-field" placeholder="Pa (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Pexit-jet','P_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pamb-jet">\(P_{ambient}\) (Ambient Pressure)</label><input type="number" id="Pamb-jet" step="any" class="input-field" placeholder="Pa (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Pamb-jet','P_ambient')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Jet Thrust</button>
            </form>
            <div id="T_jet_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('jet-menu')" class="back-button">← Back to Jet Engine</button>
        </div>

        <!-- Rocket Thrust Calculator View (T = Mdot*V_exit + A_exit(P_exit - P_ambient)) -->
        <div id="T_rocket_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Rocket Thrust (T)</h2>
            <p class="text-center text-gray-400">$$T = \dot{m} V_{exit} + A_{exit}(P_{exit} - P_{ambient})$$</p>
            <form id="T_rocket_form" onsubmit="event.preventDefault(); calculateRocketThrust()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="mdot-rocket">\(\dot{m}\) (Mass Flow Rate)</label><input type="number" id="mdot-rocket" step="any" required class="input-field" placeholder="kg/s"><button type="button" class="use-stored-button" onclick="useStoredValue('mdot-rocket','mdot')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Vexit-rocket">\(V_{exit}\) (Exit Velocity)</label><input type="number" id="Vexit-rocket" step="any" required class="input-field" placeholder="m/s"><button type="button" class="use-stored-button" onclick="useStoredValue('Vexit-rocket','V_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Aexit-rocket">\(A_{exit}\) (Exit Area)</label><input type="number" id="Aexit-rocket" step="any" class="input-field" placeholder="m² (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Aexit-rocket','A_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pexit-rocket">\(P_{exit}\) (Exit Pressure)</label><input type="number" id="Pexit-rocket" step="any" class="input-field" placeholder="Pa (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Pexit-rocket','P_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pamb-rocket">\(P_{ambient}\) (Ambient Pressure)</label><input type="number" id="Pamb-rocket" step="any" class="input-field" placeholder="Pa (optional)"><button type="button" class="use-stored-button" onclick="useStoredValue('Pamb-rocket','P_ambient')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Rocket Thrust</button>
            </form>
            <div id="T_rocket_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('rocket-menu')" class="back-button">← Back to Rocket Engine</button>
        </div>

        <!-- Propeller Power Calculator View (P = P_o * (rho/rho_o)^1.2) -->
        <div id="P_prop_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Propeller Power (P)</h2>
            <p class="text-center text-gray-400">$$P = P_o \left(\frac{\rho}{\rho_o}\right)^{1.2}$$</p>
            <form id="P_prop_form" onsubmit="event.preventDefault(); calculatePropPower()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="P0-prop">\(P_o\) (Reference Power)</label><input type="number" id="P0-prop" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('P0-prop','P_o')">Use Stored</button></div>
                <div class="w-full input-row"><label for="rho-prop">\(\rho\) (Current Density)</label><input type="number" id="rho-prop" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-prop','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="rho0-prop">\(\rho_o\) (Reference Density)</label><input type="number" id="rho0-prop" step="any" class="input-field" placeholder="e.g., 1.225"><button type="button" class="use-stored-button" onclick="useStoredValue('rho0-prop','rho_o')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate P</button>
            </form>
            <div id="P_prop_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('prop-menu')" class="back-button">← Back to Propeller</button>
        </div>

        <!-- Jet Thrust at Altitude (Troposphere) Calculator View (T = T_o * (rho/rho_o)^0.9) -->
        <div id="T_jet_alt_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Jet Thrust at Altitude (T)</h2>
            <p class="text-center text-gray-400">Troposphere: $$T = T_o \left(\frac{\rho}{\rho_o}\right)^{0.9}$$ Stratosphere: $$T = T_{11} \left(\frac{\rho}{\rho_{11}}\right)$$</p>
            <form id="T_jet_alt_form" onsubmit="event.preventDefault(); calculateJetThrustAltitude()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="layer-select" style="min-width:auto;">Layer:</label><select id="layer-select" style="flex:1 1 10rem; padding:0.75rem; background-color:#3d444d; color:white; border:1px solid #444c56; border-radius:0.5rem;"><option value="tropo">Troposphere (0.9 exponent)</option><option value="strato">Stratosphere (linear)</option></select></div>
                <div class="w-full input-row"><label for="T0-jalt">\(T_o\) or \(T_{11}\) (Ref. Thrust)</label><input type="number" id="T0-jalt" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('T0-jalt','T_o')">Use Stored</button></div>
                <div class="w-full input-row"><label for="rho-jalt">\(\rho\) (Current Density)</label><input type="number" id="rho-jalt" step="any" required class="input-field"><button type="button" class="use-stored-button" onclick="useStoredValue('rho-jalt','rho')">Use Stored</button></div>
                <div class="w-full input-row"><label for="rho0-jalt">\(\rho_o\) or \(\rho_{11}\) (Ref. Density)</label><input type="number" id="rho0-jalt" step="any" class="input-field" placeholder="e.g., 1.225"><button type="button" class="use-stored-button" onclick="useStoredValue('rho0-jalt','rho_ref')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Jet Thrust</button>
            </form>
            <div id="T_jet_alt_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('jet-menu')" class="back-button">← Back to Jet Engine</button>
        </div>

        <!-- Rocket Thrust from Chamber Calculator View (T = P_chamber * A_throat * C_F) -->
        <div id="T_rocket_chamber_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Rocket Thrust from Chamber (T)</h2>
            <p class="text-center text-gray-400">$$T = P_{chamber} \cdot A_{throat} \cdot C_F$$</p>
            <form id="T_rocket_chamber_form" onsubmit="event.preventDefault(); calculateRocketThrustChamber()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="Pcham-rocket">\(P_{chamber}\) (Chamber Pressure)</label><input type="number" id="Pcham-rocket" step="any" required class="input-field" placeholder="Pa"><button type="button" class="use-stored-button" onclick="useStoredValue('Pcham-rocket','P_chamber')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Athroat-rocket">\(A_{throat}\) (Throat Area)</label><input type="number" id="Athroat-rocket" step="any" required class="input-field" placeholder="m²"><button type="button" class="use-stored-button" onclick="useStoredValue('Athroat-rocket','A_throat')">Use Stored</button></div>
                <div class="w-full input-row"><label for="CF-rocket">\(C_F\) (Discharge Coefficient)</label><input type="number" id="CF-rocket" step="any" required class="input-field" placeholder="e.g., 1.5"><button type="button" class="use-stored-button" onclick="useStoredValue('CF-rocket','C_F')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate Thrust</button>
            </form>
            <div id="T_rocket_chamber_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('rocket-menu')" class="back-button">← Back to Rocket Engine</button>
        </div>

        <!-- Discharge Coefficient Calculator View (C_F formula) -->
        <div id="CF_calc" class="view hidden space-y-6 centered-form-content">
            <h2 class="text-xl font-semibold text-center text-green-400">Discharge Coefficient (\(C_F\))</h2>
            <p class="text-center text-gray-400">$$C_F = \sqrt{\left(\frac{2\gamma}{\gamma-1}\right)^2 \left(\frac{2}{\gamma+1}\right)^{\frac{\gamma+1}{\gamma-1}} \left(1-\frac{P_{exit}}{P_{chamber}}\right)^{\frac{\gamma-1}{\gamma}}}$$</p>
            <form id="CF_form" onsubmit="event.preventDefault(); calculateDischargeCoefficient()" class="w-full max-w-xs space-y-4">
                <div class="w-full input-row"><label for="gamma-cf">\(\gamma\) (Ratio of Specific Heats)</label><input type="number" id="gamma-cf" step="any" class="input-field" placeholder="default 1.4"><button type="button" class="use-stored-button" onclick="useStoredValue('gamma-cf','gamma')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pexit-cf">\(P_{exit}\) (Exit Pressure)</label><input type="number" id="Pexit-cf" step="any" required class="input-field" placeholder="Pa"><button type="button" class="use-stored-button" onclick="useStoredValue('Pexit-cf','P_exit')">Use Stored</button></div>
                <div class="w-full input-row"><label for="Pcham-cf">\(P_{chamber}\) (Chamber Pressure)</label><input type="number" id="Pcham-cf" step="any" required class="input-field" placeholder="Pa"><button type="button" class="use-stored-button" onclick="useStoredValue('Pcham-cf','P_chamber')">Use Stored</button></div>
                <button type="submit" class="calc-button">Calculate \(C_F\)</button>
            </form>
            <div id="CF_result" class="result-box w-full max-w-xs"></div>
            <button onclick="showView('rocket-menu')" class="back-button">← Back to Rocket Engine</button>
        </div>
    </div>

    <!-- 2. Load KaTeX JS and auto-render extension -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" xintegrity="sha384-fVEdC95A7M49uY+0Q/jO95t/K39xU+9d+o0+o5O9M3XQj8j3h2X6X4g2+5/Q5+4Q==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" xintegrity="sha384-yW9E6G/rRjH1ZtBf/L+Y/Q2P5+M41R3U3z2fQjW4g2+5/Q5+4Q==" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

    <script>
        // --- Storage Management ---
        const storedValues = {};

        function storeValue(name, value) {
            storedValues[name] = parseFloat(value);
            updateStorageDisplay();
        }

        function updateStorageDisplay() {
            const storageSection = document.getElementById('storage-section');
            const storageList = document.getElementById('storage-list');
            
            if (Object.keys(storedValues).length === 0) {
                storageSection.classList.add('hidden');
                return;
            }
            
            storageSection.classList.remove('hidden');
            storageList.innerHTML = Object.entries(storedValues).map(([name, value]) => `
                <div class="storage-item">
                    <span class="storage-label">${name}:</span>
                    <span class="storage-value">${value.toFixed(5)}</span>
                    <button class="storage-button" onclick="deleteStoredValue('${name}')">✕ Delete</button>
                </div>
            `).join('');
        }

        function deleteStoredValue(name) {
            delete storedValues[name];
            updateStorageDisplay();
        }

        function useStoredValue(inputId, variableName) {
            if (storedValues[variableName] !== undefined) {
                document.getElementById(inputId).value = storedValues[variableName];
            } else {
                alert(`Variable '${variableName}' not found in storage.`);
            }
        }

        // --- View Management ---
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            // Re-render math when a new view is shown (important for KaTeX)
            renderMathInElement(document.getElementById(viewId)); 
            document.getElementById('main-title').textContent = viewId === 'menu-view' ? 'AVP Equations' : 'Calculation Tool';
            // No explicit home-link toggle needed; home button lives inside the menu view
        }

        // Initialize the first view
        document.addEventListener('DOMContentLoaded', () => {
            showView('menu-view');
        });

        // --- Helper Function ---
        function getVal(id) {
            return parseFloat(document.getElementById(id).value);
        }

        function displayResult(containerId, formula, value, resultName = '') {
            const container = document.getElementById(containerId);
            if (isNaN(value) || !isFinite(value)) {
                 container.innerHTML = `<p class="text-red-500 mt-4 text-center">Error: Invalid input or result (e.g., division by zero or negative root).</p>`;
                 return;
            }

            const formattedValue = value.toFixed(5);
            let saveButton = '';
            if (resultName) {
                saveButton = `<button type="button" class="save-result-button" onclick="storeValue('${resultName}', ${value})">💾 Store ${resultName} = ${formattedValue}</button>`;
            }
            container.innerHTML = `
                <div class="mt-4 pt-4 border-t border-gray-600 w-full">
                    <p class="text-lg font-medium text-gray-300 mb-2 text-center">Formula Used:</p>
                    <div class="text-xl font-mono text-white p-2 bg-gray-800 rounded-lg text-center">${formula}</div>
                    <p class="text-xl font-bold mt-4 text-center">Result:</p>
                    <div class="text-4xl font-extrabold text-green-400 bg-gray-800 p-4 rounded-lg text-center">${formattedValue}</div>
                    ${saveButton}
                </div>
            `;
            renderMathInElement(container);
        }

        // --- Calculation Functions ---

        // 1. Calculate CD: CD = CDo + K * CL^2
        function calculateCD() {
            const CDo = getVal('cdo-cd');
            const K = getVal('k-cd');
            const CL = getVal('cl-cd');

            const CD = CDo + K * Math.pow(CL, 2);
            displayResult('CD_result', `$$C_D = ${CDo} + ${K} \\cdot ${CL}^2 = ${CD.toFixed(5)}$$`, CD, 'C_D');
        }

        // 2. Calculate K: K = 1 / (π * e * AR)
        function calculateK() {
            const e = getVal('e-k');
            const AR = getVal('ar-k');

            const K = 1 / (Math.PI * e * AR);
            displayResult('K_result', `$$K = \\frac{1}{\\pi \\cdot ${e} \\cdot ${AR}} = ${K.toFixed(5)}$$`, K, 'K');
        }

        // 3. Calculate AR: AR = b^2 / S
        function calculateAR() {
            const b = getVal('b-ar');
            const S = getVal('s-ar');

            const AR = Math.pow(b, 2) / S;
            displayResult('AR_result', `$$AR = \\frac{${b}^2}{${S}} = ${AR.toFixed(5)}$$`, AR, 'AR');
        }

        // 4. Calculate CL: CL = sqrt((CD - CDo) / K)
        function calculateCL() {
            const CD = getVal('cd-cl');
            const CDo = getVal('cdo-cl');
            const K = getVal('k-cl');

            const insideRoot = (CD - CDo) / K;
            
            if (insideRoot < 0) {
                 displayResult('CL_result', `$$C_L = \\sqrt{\\frac{${CD} - ${CDo}}{${K}}}$$`, NaN); // Signal error
                 return;
            }

            const CL = Math.sqrt(insideRoot);
            displayResult('CL_result', `$$C_L = \\sqrt{\\frac{${CD} - ${CDo}}{${K}}} = ${CL.toFixed(5)}$$`, CL, 'C_L');
        }

        // 5. Calculate Velocity: V = sqrt( (2*W) / (rho * S * CL) )
        function calculateV() {
            const W = getVal('W-v');
            const rho = getVal('rho-v');
            const S = getVal('S-v');
            const CL = getVal('cl-v');

            if (isNaN(W) || isNaN(rho) || isNaN(S) || isNaN(CL)) {
                displayResult('V_result', `$$V = \sqrt{\frac{2 \cdot W}{\rho \cdot S \cdot C_L}}$$`, NaN);
                return;
            }

            const denominator = rho * S * CL;
            const insideRoot = (2 * W) / denominator;

            if (denominator === 0 || insideRoot < 0) {
                 displayResult('V_result', `$$V = \sqrt{\frac{2 \cdot ${W}}{${rho} \cdot ${S} \cdot ${CL}}}$$`, NaN); // Signal error
                 return;
            }

            const V = Math.sqrt(insideRoot);
            displayResult('V_result', `$$V = \sqrt{\frac{2 \cdot ${W}}{${rho} \cdot ${S} \cdot ${CL}}} = ${V.toFixed(5)}$$`, V, 'V');
        }

        // --- Atmosphere Calculations ---
        // Troposphere: T_ISA = T_o - L*h ; P/P_o = (T_ISA/T_o)^5.256
        function calculateTropo() {
            const T0 = getVal('T0-t');
            const L = getVal('L-t');
            const h = getVal('h-t');
            const P0 = parseFloat(document.getElementById('P0-t').value);

            if (isNaN(T0) || isNaN(L) || isNaN(h)) {
                displayResult('Tropo_result', `$$T_{ISA} = T_o - L \cdot h$$`, NaN);
                return;
            }

            const T_ISA = T0 - L * h;
            const P_ratio = Math.pow(T_ISA / T0, 5.256);
            const P = !isNaN(P0) ? P0 * P_ratio : NaN;

            let formula = `$$T_{ISA} = ${T0} - ${L} \cdot ${h} = ${T_ISA.toFixed(5)}$$`;
            formula += `\\n$$\frac{P}{P_o} = \left(\frac{${T_ISA.toFixed(5)}}{${T0}}\right)^{5.256} = ${P_ratio.toFixed(5)}$$`;
            if (!isNaN(P)) formula += `\\n$$P = ${P0} \cdot ${P_ratio.toFixed(5)} = ${P.toFixed(5)}$$`;

            displayResult('Tropo_result', formula, T_ISA, 'T_ISA');
            const container = document.getElementById('Tropo_result');
            const pr = P_ratio;
            const pText = !isNaN(P) ? `Pressure: ${P.toFixed(5)} (P/P_o = ${pr.toFixed(5)})` : `P/P_o = ${pr.toFixed(5)}`;
            container.innerHTML += `<div class="mt-2 text-center text-gray-300">${pText}</div>`;
        }

        // Stratosphere: T_ISA = -56 ; P/P_o = 0.2234 * exp((11000 - h)/6342)
        function calculateStrato() {
            const h = getVal('h-s');
            const P0 = parseFloat(document.getElementById('P0-s').value);

            if (isNaN(h)) {
                displayResult('Strato_result', `$$\frac{P}{P_o} = 0.2234 \cdot e^{\frac{11000 - h}{6342}}$$`, NaN);
                return;
            }

            const T_ISA = -56;
            const P_ratio = 0.2234 * Math.exp((11000 - h) / 6342);
            const P = !isNaN(P0) ? P0 * P_ratio : NaN;

            let formula = `$$T_{ISA} = -56 = ${T_ISA}$$`;
            formula += `\\n$$\frac{P}{P_o} = 0.2234 \cdot e^{\\frac{11000 - ${h}}{6342}} = ${P_ratio.toFixed(5)}$$`;
            if (!isNaN(P)) formula += `\\n$$P = ${P0} \cdot ${P_ratio.toFixed(5)} = ${P.toFixed(5)}$$`;

            displayResult('Strato_result', formula, T_ISA, 'T_ISA');
            const container = document.getElementById('Strato_result');
            const pr = P_ratio;
            const pText = !isNaN(P) ? `Pressure: ${P.toFixed(5)} (P/P_o = ${pr.toFixed(5)})` : `P/P_o = ${pr.toFixed(5)}`;
            container.innerHTML += `<div class="mt-2 text-center text-gray-300">${pText}</div>`;
        }

        // --- Pressure, Speed of Sound, Mach, Lift ---
        function calculatePressure() {
            const rho = getVal('rho-p');
            let R = getVal('R-p');
            const T = getVal('T-p');
            if (isNaN(rho) || isNaN(T)) {
                displayResult('P_result', `$$P = \rho R T$$`, NaN);
                return;
            }
            if (isNaN(R)) R = 287.058;
            const P = rho * R * T;
            displayResult('P_result', `$$P = ${rho} \\cdot ${R} \\cdot ${T} = ${P.toFixed(5)}$$`, P, 'P');
        }

        function calculateSpeedOfSound() {
            let gamma = getVal('gamma-a');
            let R = getVal('R-a');
            const T = getVal('T-a');
            if (isNaN(T)) { displayResult('a_result', `$$a = \\sqrt{\\gamma R T}$$`, NaN); return; }
            if (isNaN(gamma)) gamma = 1.4;
            if (isNaN(R)) R = 287.058;
            const a = Math.sqrt(gamma * R * T);
            displayResult('a_result', `$$a = \\sqrt{${gamma} \\cdot ${R} \\cdot ${T}} = ${a.toFixed(5)}$$`, a, 'a');
        }

        function calculateMach() {
            const V = getVal('V-m');
            const a = getVal('a-m');
            if (isNaN(V) || isNaN(a) || a === 0) { displayResult('M_result', `$$M = V / a$$`, NaN); return; }
            const M = V / a;
            displayResult('M_result', `$$M = \\frac{${V}}{${a}} = ${M.toFixed(5)}$$`, M, 'M');
        }

        function calculateLift() {
            const rho = getVal('rho-l');
            const V = getVal('V-l');
            const S = getVal('S-l');
            const CL = getVal('cl-l');
            if (isNaN(rho) || isNaN(V) || isNaN(S) || isNaN(CL)) { displayResult('L_result', `$$L = \tfrac{1}{2} \rho V^2 S C_L$$`, NaN); return; }
            const L = 0.5 * rho * Math.pow(V, 2) * S * CL;
            displayResult('L_result', `$$L = \tfrac{1}{2} \\cdot ${rho} \\cdot ${V}^2 \\cdot ${S} \\cdot ${CL} = ${L.toFixed(5)}$$`, L, 'L');
        }

        // --- New Propulsion & Aerodynamic Equations ---
        function calculateDynamicPressure() {
            const rho = getVal('rho-q');
            const V = getVal('V-q');
            if (isNaN(rho) || isNaN(V)) { displayResult('q_result', `$$q = \tfrac{1}{2} \rho V^2$$`, NaN); return; }
            const q = 0.5 * rho * Math.pow(V, 2);
            displayResult('q_result', `$$q = \tfrac{1}{2} \\cdot ${rho} \\cdot ${V}^2 = ${q.toFixed(5)}$$`, q, 'q');
        }

        function calculateDrag() {
            const rho = getVal('rho-d');
            const V = getVal('V-d');
            const S = getVal('S-d');
            const CD = getVal('CD-d');
            if (isNaN(rho) || isNaN(V) || isNaN(S) || isNaN(CD)) { displayResult('D_result', `$$D = \tfrac{1}{2} \rho V^2 S C_D$$`, NaN); return; }
            const D = 0.5 * rho * Math.pow(V, 2) * S * CD;
            displayResult('D_result', `$$D = \tfrac{1}{2} \\cdot ${rho} \\cdot ${V}^2 \\cdot ${S} \\cdot ${CD} = ${D.toFixed(5)}$$`, D, 'D');
        }

        function calculatePropEfficiency() {
            const T = getVal('T-eta');
            const V = getVal('V-eta');
            const P = getVal('P-eta');
            if (isNaN(T) || isNaN(V) || isNaN(P) || P === 0) { displayResult('eta_p_result', `$$\eta_p = \frac{T \\cdot V}{P_{shaft}}$$`, NaN); return; }
            const eta_p = (T * V) / P;
            displayResult('eta_p_result', `$$\eta_p = \frac{${T} \\cdot ${V}}{${P}} = ${eta_p.toFixed(5)}$$`, eta_p, 'eta_p');
        }

           function calculatePropThrust() {
               const eta_p = getVal('eta-prop');
               const P = getVal('Pshaft-prop');
               const V = getVal('V-prop');
               if (isNaN(eta_p) || isNaN(P) || isNaN(V) || V === 0) { displayResult('T_prop_result', `$$T = \frac{\eta_p \\cdot P_{shaft}}{V}$$`, NaN); return; }
               const T = (eta_p * P) / V;
               displayResult('T_prop_result', `$$T = \frac{${eta_p} \\cdot ${P}}{${V}} = ${T.toFixed(5)}$$`, T, 'T');
           }

        function calculateJetThrust() {
            const mdot = getVal('mdot-jet');
            const Vexit = getVal('Vexit-jet');
            const Vinlet = getVal('Vinlet-jet');
            const Aexit = parseFloat(document.getElementById('Aexit-jet').value);
            const Pexit = parseFloat(document.getElementById('Pexit-jet').value);
            const Pamb = parseFloat(document.getElementById('Pamb-jet').value);

            if (isNaN(mdot) || isNaN(Vexit) || isNaN(Vinlet)) { displayResult('T_jet_result', `$$T = \dot{m}(V_{exit} - V_{inlet}) + A_{exit}(P_{exit} - P_{ambient})$$`, NaN); return; }

            let T = mdot * (Vexit - Vinlet);
            let pressureTerm = '';
            
            if (!isNaN(Aexit) && !isNaN(Pexit) && !isNaN(Pamb)) {
                const pressTerm = Aexit * (Pexit - Pamb);
                T += pressTerm;
                pressureTerm = `\\n$$+ A_{exit}(P_{exit} - P_{ambient}) = ${Aexit} \\cdot (${Pexit} - ${Pamb}) = ${pressTerm.toFixed(5)}$$`;
            }

            const formula = `$$T = \dot{m}(V_{exit} - V_{inlet}) = ${mdot} \\cdot (${Vexit} - ${Vinlet}) = ${(mdot * (Vexit - Vinlet)).toFixed(5)}$$${pressureTerm}`;
            displayResult('T_jet_result', formula, T, 'T_jet');
        }

        function calculateRocketThrust() {
            const mdot = getVal('mdot-rocket');
            const Vexit = getVal('Vexit-rocket');
            const Aexit = parseFloat(document.getElementById('Aexit-rocket').value);
            const Pexit = parseFloat(document.getElementById('Pexit-rocket').value);
            const Pamb = parseFloat(document.getElementById('Pamb-rocket').value);

            if (isNaN(mdot) || isNaN(Vexit)) { displayResult('T_rocket_result', `$$T = \dot{m} V_{exit} + A_{exit}(P_{exit} - P_{ambient})$$`, NaN); return; }

            let T = mdot * Vexit;
            let pressureTerm = '';
            
            if (!isNaN(Aexit) && !isNaN(Pexit) && !isNaN(Pamb)) {
                const pressTerm = Aexit * (Pexit - Pamb);
                T += pressTerm;
                pressureTerm = `\\n$$+ A_{exit}(P_{exit} - P_{ambient}) = ${Aexit} \\cdot (${Pexit} - ${Pamb}) = ${pressTerm.toFixed(5)}$$`;
            }

            const formula = `$$T = \dot{m} V_{exit} = ${mdot} \\cdot ${Vexit} = ${(mdot * Vexit).toFixed(5)}$$${pressureTerm}`;
            displayResult('T_rocket_result', formula, T, 'T_rocket');
        }

        function calculatePropPower() {
            let P0 = getVal('P0-prop');
            const rho = getVal('rho-prop');
            let rho0 = getVal('rho0-prop');
            
            if (isNaN(P0) || isNaN(rho)) { displayResult('P_prop_result', `$$P = P_o \\left(\\frac{\\rho}{\\rho_o}\\right)^{1.2}$$`, NaN); return; }
            if (isNaN(rho0)) rho0 = 1.225;
            
            if (rho0 === 0) { displayResult('P_prop_result', `$$P = P_o \\left(\\frac{\\rho}{\\rho_o}\\right)^{1.2}$$`, NaN); return; }
            
            const ratio = rho / rho0;
            const P = P0 * Math.pow(ratio, 1.2);
            displayResult('P_prop_result', `$$P = ${P0} \\cdot \\left(\\frac{${rho}}{${rho0}}\\right)^{1.2} = ${P.toFixed(5)}$$`, P, 'P');
        }

        function calculateJetThrustAltitude() {
            const layer = document.getElementById('layer-select').value;
            const T0 = getVal('T0-jalt');
            const rho = getVal('rho-jalt');
            let rho0 = getVal('rho0-jalt');
            
            if (isNaN(T0) || isNaN(rho)) { displayResult('T_jet_alt_result', `$$T = T_o \\left(\\frac{\\rho}{\\rho_o}\\right)^n$$`, NaN); return; }
            if (isNaN(rho0)) rho0 = 1.225;
            
            if (rho0 === 0) { displayResult('T_jet_alt_result', `$$T = T_o \\left(\\frac{\\rho}{\\rho_o}\\right)^n$$`, NaN); return; }
            
            let T, formula;
            if (layer === 'tropo') {
                const ratio = rho / rho0;
                T = T0 * Math.pow(ratio, 0.9);
                formula = `$$T = ${T0} \\cdot \\left(\\frac{${rho}}{${rho0}}\\right)^{0.9} = ${T.toFixed(5)}$$`;
            } else {
                const ratio = rho / rho0;
                T = T0 * ratio;
                formula = `$$T = ${T0} \\cdot \\frac{${rho}}{${rho0}} = ${T.toFixed(5)}$$`;
            }
            displayResult('T_jet_alt_result', formula, T, 'T_jet_alt');
        }

        function calculateRocketThrustChamber() {
            const Pcham = getVal('Pcham-rocket');
            const Athroat = getVal('Athroat-rocket');
            const CF = getVal('CF-rocket');
            
            if (isNaN(Pcham) || isNaN(Athroat) || isNaN(CF)) { displayResult('T_rocket_chamber_result', `$$T = P_{chamber} \\cdot A_{throat} \\cdot C_F$$`, NaN); return; }
            
            const T = Pcham * Athroat * CF;
            displayResult('T_rocket_chamber_result', `$$T = ${Pcham} \\cdot ${Athroat} \\cdot ${CF} = ${T.toFixed(5)}$$`, T, 'T_chamber');
        }

        function calculateDischargeCoefficient() {
            let gamma = getVal('gamma-cf');
            const Pexit = getVal('Pexit-cf');
            const Pcham = getVal('Pcham-cf');
            
            if (isNaN(Pexit) || isNaN(Pcham)) { displayResult('CF_result', `$$C_F = \\sqrt{...}$$`, NaN); return; }
            if (isNaN(gamma)) gamma = 1.4;
            if (Pcham === 0 || Pexit >= Pcham) { displayResult('CF_result', `$$C_F = \\sqrt{...}$$`, NaN); return; }
            
            const part1 = Math.pow(2 * gamma / (gamma - 1), 2);
            const part2 = Math.pow(2 / (gamma + 1), (gamma + 1) / (gamma - 1));
            const part3 = Math.pow(1 - Pexit / Pcham, (gamma - 1) / gamma);
            const CF = Math.sqrt(part1 * part2 * part3);
            
            displayResult('CF_result', `$$C_F = \\sqrt{\\left(\\frac{2\\gamma}{\\gamma-1}\\right)^2 \\left(\\frac{2}{\\gamma+1}\\right)^{\\frac{\\gamma+1}{\\gamma-1}} \\left(1-\\frac{P_{exit}}{P_{chamber}}\\right)^{\\frac{\\gamma-1}{\\gamma}}} = ${CF.toFixed(5)}$$`, CF, 'C_F');
        }

        // --- KaTeX Configuration ---
        function renderMathInElement(element) {
            if (window.renderMathInElement) {
                window.renderMathInElement(element, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "\\(", right: "\\)", display: false},
                    ],
                    throwOnError: false
                });
            }
        }

        // Initial render after all resources are loaded
        window.addEventListener('load', () => {
             renderMathInElement(document.body);
        });
    </script>

</body>
</html>








